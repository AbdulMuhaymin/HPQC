<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>betaFit: Modules/nllssrr.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">betaFit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f2541a3b18981391fa76fac5599e978a.html">Modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">nllssrr.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aa4596e2685395674d82d1b7ce5af721b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nllssrr_8f.html#aa4596e2685395674d82d1b7ce5af721b">nllssrr</a> (NDATA, NPTOT, NPMAX, IROUND, ROBUST, LPRINT, IFXP, YO, YU, YD, PV, PU, PS, CM, TSTPS, TSTPU, DSE)</td></tr>
<tr class="memdesc:aa4596e2685395674d82d1b7ce5af721b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Program for performing linear or non-linear least-squares fits and (if desired) automatically using sequential rounding and refitting to minimize the numbers of parameter digits which must be quoted.  <a href="nllssrr_8f.html#aa4596e2685395674d82d1b7ce5af721b">More...</a><br /></td></tr>
<tr class="separator:aa4596e2685395674d82d1b7ce5af721b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72cdb22c3991074e55fb116c7bcb81c7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nllssrr_8f.html#a72cdb22c3991074e55fb116c7bcb81c7">qrod</a> (N, NR, NC, A, R, F, B, GC, GS)</td></tr>
<tr class="memdesc:a72cdb22c3991074e55fb116c7bcb81c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs orthogonal decomposition of the linear least-squares equation:  <a href="nllssrr_8f.html#a72cdb22c3991074e55fb116c7bcb81c7">More...</a><br /></td></tr>
<tr class="separator:a72cdb22c3991074e55fb116c7bcb81c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90b7996ae81736728c989cd617df1fe7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nllssrr_8f.html#a90b7996ae81736728c989cd617df1fe7">round</a> (IROUND, NPMAX, NPARM, NPTOT, IPAR, PV, PU, PS, CM)</td></tr>
<tr class="memdesc:a90b7996ae81736728c989cd617df1fe7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subroutine to round off parameter # \( IPAR \) with value \( PV(IPAR) \) at the \( |IROUND|^{th} \) significant digit of: [its uncertainty \( PU(IPAR) \)] . On return, the rounded value replaced the initial value \( PV(IPAR) \). Then ... use the correlation matrix CM and the uncertainties \( PU(I) \) in the other \( (NPTOT-1) \) [or \( (NPARM-1) \) free] parameters to calculate the optimum compensating changes \( PV(I) \) in their values.  <a href="nllssrr_8f.html#a90b7996ae81736728c989cd617df1fe7">More...</a><br /></td></tr>
<tr class="separator:a90b7996ae81736728c989cd617df1fe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aa4596e2685395674d82d1b7ce5af721b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4596e2685395674d82d1b7ce5af721b">&#9670;&nbsp;</a></span>nllssrr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine nllssrr </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NDATA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NPTOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NPMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IROUND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ROBUST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>LPRINT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(npmax)&#160;</td>
          <td class="paramname"><em>IFXP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(ndata)&#160;</td>
          <td class="paramname"><em>YO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(ndata)&#160;</td>
          <td class="paramname"><em>YU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(ndata)&#160;</td>
          <td class="paramname"><em>YD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(nptot)&#160;</td>
          <td class="paramname"><em>PV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(nptot)&#160;</td>
          <td class="paramname"><em>PU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(nptot)&#160;</td>
          <td class="paramname"><em>PS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(npmax,npmax)&#160;</td>
          <td class="paramname"><em>CM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>TSTPS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>TSTPU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>DSE</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Program for performing linear or non-linear least-squares fits and (if desired) automatically using sequential rounding and refitting to minimize the numbers of parameter digits which must be quoted. </p>
<pre class="fragment"> [see R.J. Le Roy, J.Mol.Spectrosc. 191, 223-231 (1998)].
</pre><p> Program uses orthogonal decomposition of the "design" (partial derivative) matrix for the core locally linear (steepest descent) step, following a method introduced (to me) by Dr. Michael Dulick. If no parameters are free \( (NPTOT=0) \), simply return RMS(residuals) as calculated from the input parameter values \( {PV(j)} \).</p>
<p>A user MUST SUPPLY subroutine DYIDPJ to generate the predicted value of each datum and the partial derivatives of each datum with respect to each parameter (see below) from the current trial parameters.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
On entry:</h2>
<p>\( NDATA \) is the number of data to be fitted.</p>
<p>\( NPTOT \) is the total number of parameters in the model ( \( \leq NPMAX \)). </p><pre class="fragment"> If NPTOT &lt; or = 0, assume YD(i) = YO(i) and calculate the (RMS dimensionless deviation) = DSE from them &amp; YU(i)
</pre><p> \( NPMAX \) is the maximum number of model parameters allowed by current external array sizes. Should set internal \( NPINTMX = NPMAX \) (may be freely changed by the user).</p>
<p>\( IROUND \): </p><pre class="fragment"> != 0 - causes Sequential Rounding &amp; Refitting to be performed, with each parameter being rounded at the |IROUND|'th sig. digit of its local incertainty.

 &gt; 0 - rounding selects in turn remaining parameter with largest relative uncertainty.

 &lt; 0 - round parameters sequentially from last to first.

 = 0 - simply stops after full convergence (without rounding).
</pre><p> \( ROBUST \):</p>
<p>If ROBUST &gt; 0, causes fits to use Watson's `&lsquo;robust&rsquo;' weighting \( \frac{1}{u^2 + \frac{(c-o)^2}{3}} \).</p>
<p>If ROBUST &gt; 1, uses normal \( \frac{1}{u^2} \) on first fit cycle and 'robust' on later cycles.</p>
<p>\( LPRINT \) specifies the level of printing inside \( NLLSSRR \) If: </p><pre class="fragment"> = 0, no print except for failed convergence.

 &lt; 0, only converged, unrounded parameters, PU &amp; PS's.

 &gt;= 1, print converged parameters, PU &amp; PS's.

 &gt;= 2  also print parameter change each rounding step.

 &gt;= 3  also indicate nature of convergence.

 &gt;= 4  also print convergence tests on each cycle.

 &gt;= 5  also parameters changes &amp; uncertainties, each cycle.
</pre><p> \( IFXP(j) \) specifies whether parameter \( j \) is to be held fixed \( [IFXP &gt; 0] \) or to be freely varied in the fit \( [IFXP= 0] \).</p>
<p>\( YO(i) \) are the \( NDATA \) 'observed' data to be fitted.</p>
<p>\( YU(i) \) are the uncertainties in these \( YO(i) \) values.</p>
<p>\( PV(j) \) are initial trial parameter values (for non-linear fits); should be set at zero for initially undefined parameters.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
On Exit:</h2>
<p>\( YD(i) \) is the array of differences \( [Ycalc(i) - YO(i)] \).</p>
<p>\( PV(j) \) are the final converged parameter values.</p>
<p>\( PU(j) \) are 95% confidence limit uncertainties in the \( PV(j) \)'s.</p>
<p>\( PS(j) \) are 'parameter sensitivities' for the \( PV(j) \)'s, defined such that the RMS displacement of predicted data due to rounding off parameter- \( j \) by \( PS(j) \) is \( \leq \frac{DSE}{10NPTOT} \)</p>
<p>\( CM(j,k) \) is the correlation matrix obtained by normalizing variance/covariance matrix: </p><p class="formulaDsp">
\[ CM(j,k) = \frac{CM(j,k)}{\sqrt{CM(j,j)*CM(k,k)}} \]
</p>
<p>\( TSTPS \) is the parameter sensitivity convergence test: </p><p class="formulaDsp">
\[ TSTPS = max{\left| \frac{\Delta PV(j)}{PS(j)} \right|} \]
</p>
<p> where \( \Delta PV(j) \) is last change in parameter- \( j \).</p>
<p>\( TSTPU \) is the parameter uncertainty convergence test: </p><p class="formulaDsp">
\[ TSTPU = max{\left| \frac{\Delta PV(j)}{PU(j)} \right|} \]
</p>
<p> where \( \Delta PV(j) \) is last change in parameter- \( j \).</p>
<p>\( DSE \) is the predicted (dimensionless) standard error of the fit.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
NOTE:</h2>
<p>The squared 95% confidence limit uncertainty in a property \( F({PV(j)}) \) defined in terms of the fitted parameters \( {PV(j)} \) (where the L.H.S. involves \( [row]*[matrix]*[column] \) multiplication) is: </p><p class="formulaDsp">
\[ [D(F)]^2 = [PU(1)*dF/dPV(1), PU(2)*dF/dPV(2), ...]*[CM(j,k)]*PU(2)*dF/dPV(1), PU(2)*dF/dPV(2), ...] \]
</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Externally dimension:</h2>
<p>\( YO \), \( YU \) and \( YD \geq NDATA \)</p>
<p>\( PV \), \( PU \) and \( PS \geq NPTOT \) (say as \( NPMAX \)), \( CM \) as a square matrix with column &amp; row length \( NPMAX \). </p>

</div>
</div>
<a id="a72cdb22c3991074e55fb116c7bcb81c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72cdb22c3991074e55fb116c7bcb81c7">&#9670;&nbsp;</a></span>qrod()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine qrod </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(nr,nc)&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(n)&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(nr)&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>B</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(n)&#160;</td>
          <td class="paramname"><em>GC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(n)&#160;</td>
          <td class="paramname"><em>GS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs orthogonal decomposition of the linear least-squares equation: </p>
<p class="formulaDsp">
\[ (J*X = F) \rightarrow (A*X = B(Transpose)*F) \]
</p>
<p> where \( J \) is the Jacobian in which the first \( N \) rows and columns are transformed to the upper triangular matrix \( A (J = B*A) \), X is the independent variable vector, and F is the dependent variable vector. The transformation is applied to one row of the Jacobian matrix at a time.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Parameters:</h2>
<p>\( N \) (Integer) is the dimension of \( A \) to be transformed.</p>
<p>\( NR \) (Integer) is the row dimension of a declared in calling program.</p>
<p>\( NC \) (Integer) is the column dimension of \( F \) declared in calling program.</p>
<p>\( A \) (Real*8 array of dimensions \( \geq N*N \)) upper triangular transformation matrix.</p>
<p>\( R \) (Real*8 linear array of dimension \( \geq N \)) row of Jacobian to be added.</p>
<p>\( F \) (Real*8 linear array \( \geq \) to the row dimension of the Jacobian) transformed dependent variable matrix.</p>
<p>\( B \) (Real*8) value of \( F \) that corresponds to the added Jacobian row.</p>
<p>\( GC \) (Real*8 linear array \( \geq N \)) givens cosine transformations.</p>
<p>\( GS \) (Real*8 linear array \( \geq N \)) givens sine transformations. </p>

</div>
</div>
<a id="a90b7996ae81736728c989cd617df1fe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90b7996ae81736728c989cd617df1fe7">&#9670;&nbsp;</a></span>round()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine round </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IROUND</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NPMAX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NPARM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>NPTOT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>IPAR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(npmax)&#160;</td>
          <td class="paramname"><em>PV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(npmax)&#160;</td>
          <td class="paramname"><em>PU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(npmax)&#160;</td>
          <td class="paramname"><em>PS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(npmax,npmax)&#160;</td>
          <td class="paramname"><em>CM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subroutine to round off parameter # \( IPAR \) with value \( PV(IPAR) \) at the \( |IROUND|^{th} \) significant digit of: [its uncertainty \( PU(IPAR) \)] . On return, the rounded value replaced the initial value \( PV(IPAR) \). Then ... use the correlation matrix CM and the uncertainties \( PU(I) \) in the other \( (NPTOT-1) \) [or \( (NPARM-1) \) free] parameters to calculate the optimum compensating changes \( PV(I) \) in their values. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
